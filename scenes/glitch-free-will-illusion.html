<section class="scene full-bleed" data-scene="free-will-illusion">
  <style>
    .scene.full-bleed{display:flex;align-items:center;justify-content:center;flex-direction:column;background:var(--color-background)}
    .timeline{width:min(90%,700px);height:10px;background:var(--color-surface);border-radius:5px;position:relative;margin:2rem 0}
    .marker{position:absolute;top:50%;width:20px;height:20px;border-radius:50%;transform:translate(-50%,-50%);transition:all 1.5s cubic-bezier(.25,1,.5,1)}
    .marker.brain{background:var(--color-primary);left:5%}
    .marker.decision{background:var(--color-secondary);left:5%}
    .marker-label{position:absolute;top:30px;transform:translateX(-50%);font-size:.8rem;color:var(--color-text-muted)}
    .marker.brain .marker-label{color:var(--color-primary)}
    .marker.decision .marker-label{color:var(--color-secondary)}
    .controls{text-align:center}
    .note{margin-bottom:1rem;color:var(--color-text-main);font-size:1.2rem;min-height:1.5em}
    .done{position:absolute;right:1rem;bottom:1rem}
  </style>

  <div class="controls">
    <div id="note" class="note">Нажмите, когда решите...</div>
    <button id="action-btn" class="btn">Совершить действие</button>
  </div>
  <div class="timeline">
    <div id="brain-marker" class="marker brain"><div class="marker-label">Активность мозга</div></div>
    <div id="decision-marker" class="marker decision"><div class="marker-label">Ваше решение</div></div>
  </div>
  <div class="done"><button id="finish" class="btn">Завершить сцену</button></div>

  <script>
  (function(){
    const root=document.currentScript.closest('[data-scene="free-will-illusion"]');
    const note=root.querySelector('#note'),actionBtn=root.querySelector('#action-btn');
    const brain=root.querySelector('#brain-marker'),decision=root.querySelector('#decision-marker');
    const finishBtn=root.querySelector('#finish');

    function runExperiment(){
      actionBtn.disabled=true;
      note.textContent='Запускаем процесс...';
      brain.style.left='5%'; decision.style.left='5%';

      setTimeout(()=>{ note.textContent='Мозг инициирует действие...'; brain.style.left='50%'; }, 500);
      setTimeout(()=>{ note.textContent='Вы осознаете решение...'; decision.style.left='70%'; }, 1000);
      setTimeout(()=>{ note.textContent='Действие совершено. Активность мозга предшествовала решению.'; }, 1500);
      setTimeout(()=>{ actionBtn.disabled=false; note.textContent='Нажмите, когда решите...'; }, 4000);
    }
    function onMount(){ actionBtn.addEventListener('click',runExperiment); }
    function onUnmount(){ actionBtn.removeEventListener('click',runExperiment); }
    finishBtn.addEventListener('click',()=>{try{window.Progress?.markDone?.('free-will-illusion')}catch(e){};finishBtn.textContent='Готово ✓';finishBtn.disabled=true;});
    if(window.SceneFrame?.register){window.SceneFrame.register(root,{onMount,onUnmount});}else{onMount();}
  })();
  </script>
</section>
