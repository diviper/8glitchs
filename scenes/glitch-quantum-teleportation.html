<!-- htmlhint doctype-first:false -->
<section class="scene full-bleed" data-scene="quantum-teleportation">
  <style>
    .scene.full-bleed{position:relative;inset:0;display:grid;grid-template-rows:auto 1fr auto;min-height:calc(100vh - 64px)}
    .panel{margin:1rem;display:flex;gap:1rem;flex-wrap:wrap;background:rgba(0,0,0,.4);backdrop-filter:blur(6px);padding:1rem;border-radius:.8rem}
    .panel label{font:600 13px/1.2 system-ui;display:flex;gap:.5rem;align-items:center}
    .chip{display:inline-block;padding:.25rem .5rem;border-radius:999px;background:rgba(255,255,255,.08);font:12px/1.2 system-ui}
    .board{position:relative;margin:0 1rem 1rem 1rem;border-radius:.8rem;background:rgba(255,255,255,.03);display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem;padding:1rem}
    .card{background:rgba(0,0,0,.35);border-radius:.8rem;padding:1rem}
    .title{font:600 13px/1 system-ui;opacity:.85;margin-bottom:.5rem}
    .state{font:12px/1.4 ui-monospace,monospace;opacity:.95}
    .row{display:flex;gap:.5rem;align-items:center}
    .btn{border:0;border-radius:.6rem;padding:.6rem 1rem;background:#1f6feb;color:#fff;font:600 14px/1;cursor:pointer}
    .foot{display:flex;justify-content:flex-end;gap:.5rem;margin:0 1rem 1rem}
  </style>

  <div class="panel">
    <label>Состояние источника θ:
      <input type="range" id="theta" min="0" max="180" step="1" value="32">
      <span class="chip" id="tval">32°</span>
    </label>
    <span class="chip">|ψ⟩ = cos(θ/2)|0⟩ + sin(θ/2)|1⟩ (реальные амплитуды)</span>
  </div>

  <div class="board">
    <div class="card">
      <div class="title">1) Подготовка</div>
      <div class="state" id="prep">A–B = Bell; S = |ψ⟩</div>
    </div>
    <div class="card">
      <div class="title">2) Измерения (два бита)</div>
      <div class="state" id="meas">m₁,m₂ = —</div>
    </div>
    <div class="card">
      <div class="title">3) Коррекции Боба</div>
      <div class="state" id="corr">U = X^m₂ · Z^m₁</div>
    </div>
    <div class="card">
      <div class="title">Исходное состояние |ψ⟩</div>
      <div class="state" id="psi0">—</div>
    </div>
    <div class="card">
      <div class="title">Итог на B после коррекций</div>
      <div class="state" id="psiB">—</div>
    </div>
    <div class="card">
      <div class="title">Совпадение</div>
      <div class="state" id="fid">—</div>
    </div>
  </div>

  <div class="foot">
    <button class="btn" id="go">Телепортировать</button>
    <button class="btn" id="done">Завершить сцену</button>
  </div>

  <script>
  (function(){
    const root=document.currentScript.closest('[data-scene="quantum-teleportation"]');
    const thetaEl=root.querySelector('#theta'), tval=root.querySelector('#tval');
    const prep=root.querySelector('#prep'), meas=root.querySelector('#meas'), corr=root.querySelector('#corr');
    const psi0=root.querySelector('#psi0'), psiB=root.querySelector('#psiB'), fid=root.querySelector('#fid');
    const go=root.querySelector('#go'), done=root.querySelector('#done');

    function fmt(a,b){return 'α='+a.toFixed(3)+', β='+b.toFixed(3);} 
    function stateFromTheta(deg){const th=deg*Math.PI/180; const a=Math.cos(th/2), b=Math.sin(th/2); return [a,b];}
    function fidelity(a,b){const d=Math.hypot(a[0]-b[0], a[1]-b[1]); return Math.max(0,1-d).toFixed(3);}

    function refresh(){
      const ab=stateFromTheta(+thetaEl.value);
      tval.textContent=thetaEl.value+'°';
      psi0.textContent=fmt(ab[0],ab[1]);
      prep.textContent='A–B = Bell; S = |ψ⟩ ('+fmt(ab[0],ab[1])+')';
      meas.textContent='m₁,m₂ = —';
      corr.textContent='U = X^m₂ · Z^m₁';
      psiB.textContent='—'; fid.textContent='—';
    }

    function teleport(){
      const ab=stateFromTheta(+thetaEl.value);
      const m1=(Math.random()<0.5)?0:1;
      const m2=(Math.random()<0.5)?0:1;
      meas.textContent='m₁='+m1+', m₂='+m2;
      corr.textContent='U = X^'+m2+' · Z^'+m1;
      psiB.textContent=fmt(ab[0],ab[1]);
      fid.textContent='F ≈ '+fidelity(ab,ab);
    }

    function onMount(){refresh(); thetaEl.addEventListener('input',refresh); go.addEventListener('click',teleport);}
    function onUnmount(){thetaEl.removeEventListener('input',refresh); go.removeEventListener('click',teleport);}

    done.addEventListener('click',()=>{try{window.Progress?.markDone?.('quantum-teleportation')}catch{};done.textContent='Готово ✓';done.disabled=true;});

    if(window.SceneFrame?.register){window.SceneFrame.register(root,{onMount,onUnmount});} else {onMount();}
  })();
  </script>
</section>
