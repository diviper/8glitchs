<section class="scene full-bleed" data-scene="ship-of-theseus">
  <style>
    .scene.full-bleed{display:flex;flex-direction:column;align-items:center;justify-content:center;background:var(--color-background)}
    .ship-container{padding:1rem}
    .ship-svg{width:min(80vw,400px);height:auto}
    .ship-svg .original-part{fill:#8a6d3b;stroke:#5a4a2a;stroke-width:2px;transition:fill .3s ease}
    .ship-svg .replaced-part{fill:var(--color-secondary);stroke:var(--color-primary)}
    .ui-panel{text-align:center;background:var(--color-surface);padding:1rem 1.5rem;border-radius:.8rem;margin-top:1rem;border:1px solid var(--color-border)}
    .status-text{font-size:1.1rem;margin-bottom:1rem;min-height:2em;color:var(--color-text-main)}
    .btn{border:0;border-radius:.6rem;padding:.75rem 1.5rem;background:var(--color-primary);color:#fff;font:600 14px/1 var(--font-main);cursor:pointer;text-transform:uppercase}
    .btn:disabled{background:#555;cursor:not-allowed}
    .done{position:absolute;right:1rem;bottom:1rem}
  </style>

  <div class="ship-container">
    <svg id="ship" class="ship-svg" viewBox="0 0 200 150">
      <path id="part-hull" class="original-part" d="M 10 100 L 40 130 L 160 130 L 190 100 L 10 100 Z" />
      <rect id="part-deck" class="original-part" x="25" y="90" width="150" height="10" />
      <rect id="part-mast" class="original-part" x="95" y="20" width="10" height="70" />
      <path id="part-sail" class="original-part" d="M 105 25 C 145 35, 145 75, 105 85 L 105 25 Z" />
    </svg>
  </div>
  <div class="ui-panel">
    <div id="status" class="status-text">Корабль оригинален. Заменено 0%.</div>
    <button id="replace-btn" class="btn">Заменить одну часть</button>
  </div>
  <div class="done"><button id="finish" class="btn">Завершить сцену</button></div>

  <script>
  (function(){
    const root=document.currentScript.closest('[data-scene="ship-of-theseus"]');
    const statusEl=root.querySelector('#status'),replaceBtn=root.querySelector('#replace-btn'),finishBtn=root.querySelector('#finish');
    const parts=Array.from(root.querySelectorAll('.original-part'));
    const totalParts=parts.length;
    let replacedCount=0;
    function replacePart(){
      if(parts.length===0)return;
      const partToReplace=parts.pop();
      partToReplace.classList.remove('original-part');partToReplace.classList.add('replaced-part');
      replacedCount++;
      const percentage=Math.round((replacedCount/totalParts)*100);
      statusEl.textContent=`Заменено ${percentage}% частей. Это всё ещё тот же корабль?`;
      if(parts.length===0){
        statusEl.textContent='Все 100% частей заменены. Это новый корабль или старый?';
        replaceBtn.disabled=true;replaceBtn.textContent='Реставрация завершена';
      }
    }
    function onMount(){replaceBtn.addEventListener('click',replacePart);}
    function onUnmount(){replaceBtn.removeEventListener('click',replacePart);}
    finishBtn.addEventListener('click',()=>{try{window.Progress?.markDone?.('ship-of-theseus')}catch(e){};finishBtn.textContent='Готово ✓';finishBtn.disabled=true;});
    if(window.SceneFrame?.register){window.SceneFrame.register(root,{onMount,onUnmount});}else{onMount();}
  })();
  </script>
</section>
